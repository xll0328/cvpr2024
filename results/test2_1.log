Start running self_mm...
<Storage{'is_tune': False, 'train_mode': 'regression', 'modelName': 'self_mm', 'datasetName': 'mosi', 'emb_size': 9, 'num_workers': 12, 'model_save_dir': 'results/models_cvpr2024', 'res_save_dir': 'results/results_cvpr2024/normals', 'gpu_ids': [0], 'a1': 0.5, 'a2': 1.5, 'num': 1, 'seeds': [2024], 'dataPath': '/root/autodl-tmp/cvpr2024/config/MMSA/Datasets/MOSI/unaligned_50.pkl', 'seq_lens': (50, 50, 50), 'feature_dims': (768, 5, 20), 'train_samples': 1284, 'num_classes': 3, 'language': 'en', 'KeyEval': 'Loss', 'need_data_aligned': False, 'need_model_aligned': False, 'need_normalized': False, 'use_bert': True, 'use_finetune': True, 'save_labels': False, 'early_stop': 8, 'update_epochs': 4, 'batch_size': 16, 'learning_rate_bert': 5e-05, 'learning_rate_audio': 0.001, 'learning_rate_video': 0.0001, 'learning_rate_other': 0.001, 'weight_decay_bert': 0.001, 'weight_decay_audio': 0.01, 'weight_decay_video': 0.001, 'weight_decay_other': 0.001, 'a_lstm_hidden_size': 32, 'v_lstm_hidden_size': 64, 'a_lstm_layers': 1, 'v_lstm_layers': 1, 'text_out': 768, 'audio_out': 16, 'video_out': 32, 'a_lstm_dropout': 0.0, 'v_lstm_dropout': 0.0, 't_bert_dropout': 0.1, 'post_fusion_dim': 128, 'post_text_dim': 64, 'post_audio_dim': 16, 'post_video_dim': 32, 'post_fusion_dropout': 0.1, 'post_text_dropout': 0.0, 'post_audio_dropout': 0.1, 'post_video_dropout': 0.1, 'H': 3.0, 'loss1': 0.5, 'loss2': 1.5, 'seed': 2024}>
Let's use 1 GPUs!
train samples: (1284,)
valid samples: (229,)
test samples: (686,)
The model has 109808818 trainable parameters
Init labels...
run_normal
  0%|                                                                                                                                                                         | 0/81 [00:00<?, ?it/s]  1%|█▉                                                                                                                                                               | 1/81 [00:01<01:45,  1.32s/it]  2%|███▉                                                                                                                                                             | 2/81 [00:01<00:47,  1.66it/s] 21%|█████████████████████████████████▌                                                                                                                              | 17/81 [00:01<00:03, 19.54it/s] 43%|█████████████████████████████████████████████████████████████████████▏                                                                                          | 35/81 [00:01<00:01, 42.91it/s] 57%|██████████████████████████████████████████████████████████████████████████████████████████▊                                                                     | 46/81 [00:01<00:00, 52.84it/s] 70%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████▌                                               | 57/81 [00:01<00:00, 63.41it/s] 84%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▎                         | 68/81 [00:01<00:00, 73.02it/s] 98%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████    | 79/81 [00:02<00:00, 77.67it/s]100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 81/81 [00:02<00:00, 36.01it/s]
Start training...
  0%|                                                                                                                                                                         | 0/81 [00:00<?, ?it/s]  1%|█▉                                                                                                                                                               | 1/81 [00:02<02:49,  2.12s/it]  2%|███▉                                                                                                                                                             | 2/81 [00:02<01:14,  1.06it/s]  4%|█████▉                                                                                                                                                           | 3/81 [00:02<00:44,  1.77it/s]  5%|███████▉                                                                                                                                                         | 4/81 [00:02<00:30,  2.51it/s]  6%|█████████▉                                                                                                                                                       | 5/81 [00:02<00:22,  3.36it/s]  7%|███████████▉                                                                                                                                                     | 6/81 [00:02<00:17,  4.17it/s]  9%|█████████████▉                                                                                                                                                   | 7/81 [00:02<00:14,  5.05it/s] 10%|███████████████▉                                                                                                                                                 | 8/81 [00:02<00:12,  5.70it/s] 11%|█████████████████▉                                                                                                                                               | 9/81 [00:03<00:11,  6.42it/s] 12%|███████████████████▊                                                                                                                                            | 10/81 [00:03<00:10,  6.96it/s] 14%|█████████████████████▋                                                                                                                                          | 11/81 [00:03<00:10,  6.68it/s] 15%|███████████████████████▋                                                                                                                                        | 12/81 [00:03<00:10,  6.30it/s] 16%|█████████████████████████▋                                                                                                                                      | 13/81 [00:03<00:09,  6.83it/s] 17%|███████████████████████████▋                                                                                                                                    | 14/81 [00:03<00:09,  7.18it/s] 19%|█████████████████████████████▋                                                                                                                                  | 15/81 [00:03<00:08,  7.52it/s] 20%|███████████████████████████████▌                                                                                                                                | 16/81 [00:04<00:08,  7.86it/s] 21%|█████████████████████████████████▌                                                                                                                              | 17/81 [00:04<00:07,  8.16it/s] 22%|███████████████████████████████████▌                                                                                                                            | 18/81 [00:04<00:07,  8.29it/s] 23%|█████████████████████████████████████▌                                                                                                                          | 19/81 [00:04<00:07,  8.40it/s] 25%|███████████████████████████████████████▌                                                                                                                        | 20/81 [00:04<00:07,  8.34it/s] 26%|█████████████████████████████████████████▍                                                                                                                      | 21/81 [00:04<00:07,  8.30it/s] 27%|███████████████████████████████████████████▍                                                                                                                    | 22/81 [00:04<00:07,  7.98it/s] 28%|█████████████████████████████████████████████▍                                                                                                                  | 23/81 [00:04<00:07,  7.47it/s] 30%|███████████████████████████████████████████████▍                                                                                                                | 24/81 [00:05<00:10,  5.62it/s] 31%|█████████████████████████████████████████████████▍                                                                                                              | 25/81 [00:05<00:09,  5.94it/s] 32%|███████████████████████████████████████████████████▎                                                                                                            | 26/81 [00:05<00:08,  6.22it/s] 33%|█████████████████████████████████████████████████████▎                                                                                                          | 27/81 [00:05<00:08,  6.49it/s] 35%|███████████████████████████████████████████████████████▎                                                                                                        | 28/81 [00:05<00:07,  6.79it/s] 36%|█████████████████████████████████████████████████████████▎                                                                                                      | 29/81 [00:05<00:07,  7.27it/s] 37%|███████████████████████████████████████████████████████████▎                                                                                                    | 30/81 [00:05<00:06,  7.62it/s] 38%|█████████████████████████████████████████████████████████████▏                                                                                                  | 31/81 [00:06<00:06,  7.85it/s] 40%|███████████████████████████████████████████████████████████████▏                                                                                                | 32/81 [00:06<00:06,  7.93it/s] 41%|█████████████████████████████████████████████████████████████████▏                                                                                              | 33/81 [00:06<00:06,  7.81it/s] 42%|███████████████████████████████████████████████████████████████████▏                                                                                            | 34/81 [00:06<00:06,  7.75it/s] 43%|█████████████████████████████████████████████████████████████████████▏                                                                                          | 35/81 [00:06<00:06,  7.52it/s] 44%|███████████████████████████████████████████████████████████████████████                                                                                         | 36/81 [00:06<00:08,  5.52it/s] 46%|█████████████████████████████████████████████████████████████████████████                                                                                       | 37/81 [00:07<00:07,  5.93it/s] 47%|███████████████████████████████████████████████████████████████████████████                                                                                     | 38/81 [00:07<00:06,  6.22it/s] 48%|█████████████████████████████████████████████████████████████████████████████                                                                                   | 39/81 [00:07<00:06,  6.38it/s] 49%|███████████████████████████████████████████████████████████████████████████████                                                                                 | 40/81 [00:07<00:06,  6.19it/s] 49%|███████████████████████████████████████████████████████████████████████████████                                                                                 | 40/81 [00:07<00:07,  5.21it/s]
Traceback (most recent call last):
  File "run.py", line 255, in <module>
    run_normal(args)
  File "run.py", line 170, in run_normal
    test_results = run(args)
  File "run.py", line 72, in run
    atio.do_train(model, dataloader)
  File "/root/autodl-tmp/cvpr2024/trains/multiTask/SELF_MM.py", line 182, in do_train
    outputs = model(text, (audio, audio_lengths.cpu()), (vision, vision_lengths.cpu()))
  File "/root/miniconda3/lib/python3.8/site-packages/torch/nn/modules/module.py", line 1518, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
  File "/root/miniconda3/lib/python3.8/site-packages/torch/nn/modules/module.py", line 1527, in _call_impl
    return forward_call(*args, **kwargs)
  File "/root/autodl-tmp/cvpr2024/models/AMIO.py", line 35, in forward
    return self.Model(text_x, audio_x, video_x)
  File "/root/miniconda3/lib/python3.8/site-packages/torch/nn/modules/module.py", line 1518, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
  File "/root/miniconda3/lib/python3.8/site-packages/torch/nn/modules/module.py", line 1527, in _call_impl
    return forward_call(*args, **kwargs)
  File "/root/autodl-tmp/cvpr2024/models/multiTask/SELF_MM.py", line 124, in forward
    text = self.text_model(text)[:,0,:]
  File "/root/miniconda3/lib/python3.8/site-packages/torch/nn/modules/module.py", line 1518, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
  File "/root/miniconda3/lib/python3.8/site-packages/torch/nn/modules/module.py", line 1527, in _call_impl
    return forward_call(*args, **kwargs)
  File "/root/autodl-tmp/cvpr2024/models/subNets/BertTextEncoder.py", line 57, in forward
    last_hidden_states = self.model(input_ids=input_ids,
  File "/root/miniconda3/lib/python3.8/site-packages/torch/nn/modules/module.py", line 1518, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
  File "/root/miniconda3/lib/python3.8/site-packages/torch/nn/modules/module.py", line 1527, in _call_impl
    return forward_call(*args, **kwargs)
  File "/root/miniconda3/lib/python3.8/site-packages/transformers/models/bert/modeling_bert.py", line 1022, in forward
    encoder_outputs = self.encoder(
  File "/root/miniconda3/lib/python3.8/site-packages/torch/nn/modules/module.py", line 1518, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
  File "/root/miniconda3/lib/python3.8/site-packages/torch/nn/modules/module.py", line 1527, in _call_impl
    return forward_call(*args, **kwargs)
  File "/root/miniconda3/lib/python3.8/site-packages/transformers/models/bert/modeling_bert.py", line 612, in forward
    layer_outputs = layer_module(
  File "/root/miniconda3/lib/python3.8/site-packages/torch/nn/modules/module.py", line 1518, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
  File "/root/miniconda3/lib/python3.8/site-packages/torch/nn/modules/module.py", line 1527, in _call_impl
    return forward_call(*args, **kwargs)
  File "/root/miniconda3/lib/python3.8/site-packages/transformers/models/bert/modeling_bert.py", line 539, in forward
    layer_output = apply_chunking_to_forward(
  File "/root/miniconda3/lib/python3.8/site-packages/transformers/pytorch_utils.py", line 240, in apply_chunking_to_forward
    return forward_fn(*input_tensors)
  File "/root/miniconda3/lib/python3.8/site-packages/transformers/models/bert/modeling_bert.py", line 551, in feed_forward_chunk
    intermediate_output = self.intermediate(attention_output)
  File "/root/miniconda3/lib/python3.8/site-packages/torch/nn/modules/module.py", line 1518, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
  File "/root/miniconda3/lib/python3.8/site-packages/torch/nn/modules/module.py", line 1527, in _call_impl
    return forward_call(*args, **kwargs)
  File "/root/miniconda3/lib/python3.8/site-packages/transformers/models/bert/modeling_bert.py", line 451, in forward
    hidden_states = self.dense(hidden_states)
  File "/root/miniconda3/lib/python3.8/site-packages/torch/nn/modules/module.py", line 1518, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
  File "/root/miniconda3/lib/python3.8/site-packages/torch/nn/modules/module.py", line 1527, in _call_impl
    return forward_call(*args, **kwargs)
  File "/root/miniconda3/lib/python3.8/site-packages/torch/nn/modules/linear.py", line 114, in forward
    return F.linear(input, self.weight, self.bias)
torch.cuda.OutOfMemoryError: CUDA out of memory. Tried to allocate 2.00 MiB. GPU 0 has a total capacty of 23.69 GiB of which 2.94 MiB is free. Process 935921 has 23.69 GiB memory in use. Of the allocated memory 21.08 GiB is allocated by PyTorch, and 1.40 GiB is reserved by PyTorch but unallocated. If reserved but unallocated memory is large try setting max_split_size_mb to avoid fragmentation.  See documentation for Memory Management and PYTORCH_CUDA_ALLOC_CONF
